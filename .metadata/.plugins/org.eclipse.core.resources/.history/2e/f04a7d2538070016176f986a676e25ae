(function() {
	angular.module("chatApp").controller("chatController", chatController);
	
	chatController.$inject = ['$scope', '$websocket', 'userService'];
	
	function chatController($scope, $websocket, userService) {
	
		$scope.msgList = [];
		$scope.userList = [];
		
		var dataStream = $websocket('ws://localhost:8080/ChatAppClient/websocket');
		
		dataStream.onMessage(function(message) {
			console.log(message);
			
			var msg = JSON.parse(message.data);
			
			if(msg.type == "msg") {
				$scope.msgList.push(msg.content);
			} else if(msg.type == "user") {
				$scope.userList.push(msg.data);
			}
			
			
		});
		
		$scope.sendMsg = function()
		{
			var msgData = {"type" : "msg", "content" : $scope.msgText, "from": userService.getUser()};
			
			console.log(msgData);
			
			dataStream.send(msgData);
			$scope.msgText = "";
		}
		
		$scope.sendUserLogin = (function() {
			var userData = {"type" : "user", "name" : userService.getUser()};
			
			dataStream.send(userData)
			
		})();
		
	};
})();
